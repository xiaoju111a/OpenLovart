# 新功能更新说明

## ✨ 已实现的功能

### 1. 图片/视频元素上下文工具栏

点击图片或视频元素时，会在元素上方显示一个专门的工具栏，包含以下功能：

**工具栏按钮：**
- 📐 **尺寸显示** - 显示当前元素的宽度和高度
- 🎨 **替换背景** - 移除或替换图片背景
- 👕 **Mockup** - 将图片应用到产品模型上
- ✨ **编辑元素** - 使用 AI 编辑图片
- ➡️ **流程** - 创建流程图连接（见下方）
- 🔮 **扩展元素** - 基于当前图片生成新图片
- 📋 **复制** - 复制当前元素
- ⬇️ **下载** - 下载图片/视频
- 🗑️ **删除** - 删除元素

### 2. 流程图连接功能

点击图片/视频元素工具栏中的 **"流程"** 按钮，会自动创建：

1. **虚线连接器** - 从源元素到新元素的虚线箭头
2. **图像生成器** - 在右侧自动创建一个新的图像生成器元素
3. **分组关联** - 所有相关元素会被分组，移动时会一起移动

**特点：**
- 使用虚线箭头表示流程关系
- 自动计算元素间距（120px）
- 支持拖动整个流程组

### 3. 视频上传支持

在左侧浮动工具栏中：

1. 点击 **"+"** 按钮
2. 选择 **"上传视频"**
3. 支持所有常见视频格式（mp4, mov, avi, webm 等）
4. 视频会以预览形式显示在画布上
5. 视频元素也支持相同的上下文工具栏

### 4. 连接器渲染

- 连接线会自动从源元素中心连接到目标元素中心
- 支持实线和虚线两种样式
- 带有箭头指示方向
- 连接线会在元素层下方渲染，不会遮挡元素

## 🎨 UI 改进

### 图片/视频工具栏样式
- 圆角设计（rounded-xl）
- 白色背景，灰色边框
- 按钮悬停效果
- 特殊按钮（如"流程"）使用蓝色高亮
- "扩展元素"使用渐变色（紫色到蓝色）

### 视频元素样式
- 圆角边框（rounded-lg）
- 自动适应容器大小（object-cover）
- 禁用默认控制条
- 自动循环播放
- 静音播放

## 📝 使用方法

### 创建流程图

1. 上传一张图片到画布
2. 点击图片选中它
3. 在上方工具栏点击 **"流程"** 按钮
4. 系统会自动创建：
   - 虚线连接器
   - 图像生成器元素
5. 在图像生成器中输入提示词生成新图片
6. 拖动任一元素，整个流程组会一起移动

### 上传视频

1. 点击左侧工具栏的 **"+"** 按钮
2. 选择 **"上传视频"**
3. 选择视频文件
4. 视频会显示在画布上
5. 可以调整大小、位置
6. 点击视频可以使用相同的工具栏功能

## 🔧 技术实现

### 新增类型

```typescript
// 元素类型新增
type CanvasElementType = 'image' | 'text' | 'shape' | 'path' | 'image-generator' | 'video' | 'connector';

// 连接器属性
interface CanvasElement {
  // ... 其他属性
  connectorFrom?: string;      // 源元素 ID
  connectorTo?: string;        // 目标元素 ID
  connectorStyle?: 'solid' | 'dashed';  // 连接线样式
}
```

### 组件更新

1. **ContextToolbar.tsx** - 为图片/视频元素提供专门的工具栏
2. **CanvasArea.tsx** - 添加连接器渲染层和视频元素支持
3. **FloatingToolbar.tsx** - 添加视频上传选项
4. **canvas/page.tsx** - 实现流程图连接和视频处理逻辑

## 🎯 下一步可以添加的功能

- [ ] 视频播放控制（播放/暂停）
- [ ] 连接器样式自定义（颜色、粗细）
- [ ] 多种连接器类型（直线、曲线、折线）
- [ ] 流程图自动布局
- [ ] 视频剪辑功能
- [ ] 视频转 GIF
- [ ] 批量连接多个元素

## 🐛 已知问题

- TypeScript 类型错误（Supabase 相关）- 不影响功能
- 视频元素暂时没有播放控制
- 连接器不支持手动调整路径

## 📸 效果预览

工具栏会显示在选中的图片/视频元素上方，包含所有功能按钮。
流程图连接会使用虚线箭头连接元素，创建清晰的视觉流程。
